# 芯片失效分析AI Agent系统 总体技术方案说明书（正式版）

**文档版本**：V1.0

**文档状态**：正式交付版

**编制人**：XXX

**编制日期**：XXX

**审核人**：XXX

**审核日期**：XXX

**批准人**：XXX

**批准日期**：XXX

**交付对象**：XXX（内部研发/项目对接组）

**文档说明**：本文档为芯片失效分析AI Agent系统的全量技术方案，包含系统架构、核心设计、技术细节、数据库设计、部署实施等内容，用于指导系统开发、部署落地及后期维护，兼具专业性、规范性和可操作性，可直接作为正式交付文档存档。

# 目录

1. 项目概述
        

    1. 项目背景

    2. 建设目标

    3. 核心约束

    4. 适用范围

2. 总体架构设计
        

    1. 架构概述

    2. 总体架构图

    3. 分层职责详解

    4. 核心设计原则

3. 核心模块设计（2-Agent折中方案）
        

    1. Agent层总体设计

    2. Agent1：推理核心模块详细设计

    3. Agent2：落地闭环模块详细设计

    4. Agent编排逻辑（LangGraph）

    5. 专家介入模块设计

4. MCP标准能力网关设计
        

    1. MCP定位与协议规范

    2. 核心工具集设计

    3. 接口定义与调用规范

    4. 异常处理机制

5. 知识图谱+数据存储层详细设计
        

    1. 总体设计

    2. 知识图谱子层设计（Neo4j）

    3. 数据存储子层设计

    4. 数据库格式与表结构

    5. 数据同步与备份机制

6. 芯片领域能力处理方案
        

    1. 芯片领域能力分类

    2. 显性知识能力落地设计

    3. 隐性工程能力落地设计

    4. 能力迭代与更新机制

7. 推理体系详细设计


    1. 三层推理体系概述

    2. 底层精准推理设计

    3. 中层业务推理设计（Agent）

    4. 表层语言增强设计（LLM）

    5. 推理链路可追溯设计

8. 技术栈详细说明
        

    1. 前端技术栈

    2. 网关层技术栈

    3. Agent层技术栈

    4. MCP层技术栈

    5. 知识与数据层技术栈

    6. 部署技术栈

9. 系统功能模块详细说明
        

    1. 日志上传与解析模块

    2. 故障特征提取模块

    3. 失效模块定位模块

    4. 根因推理模块

    5. 相似案例匹配模块

    6. 分析报告生成模块

    7. 结果存储与查询模块

    8. 专家审核与修正模块

    9. 知识图谱可视化与编辑模块

    10. 操作日志与审计模块

10. 部署方案
        

    1. 部署架构

    2. 硬件配置要求

    3. 软件配置要求

    4. 部署步骤

    5. 部署验证

11. 测试方案
        

    1. 测试目标

    2. 测试范围

    3. 测试环境

    4. 测试用例设计

    5. 测试执行与验收标准

12. 风险与对策
        

    1. 技术风险

    2. 项目风险

    3. 运维风险

13. 扩展规划


    1. V1.0版本（基础版）

    2. V2.0版本（增强版）

    3. V3.0版本（完整版）

14. 维护方案
        

    1. 日常维护内容

    2. 维护流程

    3. 故障排查流程

    4. 版本迭代维护

15. 方案总结

# 一、项目概述

## 1.1 项目背景

在芯片研发、量产及失效分析全流程中，传统人工分析模式存在效率低、一致性差、知识难以沉淀、专家依赖度高的核心痛点：芯片故障日志格式复杂（部分为原厂加密/自定义格式）、失效模块定位需依赖资深工程师经验、根因推理缺乏标准化链路、历史故障案例难以快速复用，导致芯片失效分析周期长、成本高，无法满足规模化研发与量产的效率需求。

为解决上述痛点，本项目构建芯片失效分析AI Agent系统，将芯片领域专家知识、故障分析经验、工程化解析能力与AI技术深度融合，实现“日志上传→信息提取→失效定界→根因推理→报告生成→知识闭环”的全流程自动化、标准化，替代人工重复劳动，提升分析一致性与效率，沉淀芯片失效分析知识资产，降低对资深专家的依赖，支撑芯片研发与量产的高效推进。

## 1.2 建设目标

1. **自动化目标**：实现标准化故障场景（占比≥80%）全流程自动化分析，无需人工介入，日志上传后10秒内完成特征提取，30秒内输出推理结果与分析报告。

2. **可解释性目标**：推理链路全程可追溯、可可视化，每一步推理结果均能对应明确的知识依据（规则/案例/芯片工具结果），无黑盒推理，满足芯片工程化可靠性要求。

3. **轻量化目标**：采用Docker Compose一键部署，无需K8s、复杂微服务及高端硬件，单台服务器即可支撑系统稳定运行，1名运维人员可完成日常维护。

4. **可扩展性目标**：支持多芯片型号（≥10种主流SoC/MCU芯片）、多故障类型（覆盖SRAM、DDR、NoC、CPU核等核心模块失效），支持专家介入修正与知识迭代，可快速集成新增芯片工具与推理规则。

5. **知识沉淀目标**：实现芯片失效知识（规则、案例、修正意见）的结构化沉淀与自动迭代，形成可复用、可扩展的芯片失效知识体系，降低专家依赖。

6. **准确性目标**：标准化故障场景推理准确率≥95%，低置信度场景（置信度<0.7）自动触发专家介入，修正后准确率≥99%。

## 1.3 核心约束

1. **技术约束**：芯片领域核心能力不可硬编码，需实现知识化、图谱化、可配置，便于专家直接编辑更新；核心推理逻辑不依赖大模型幻觉，优先采用规则引擎+芯片工程工具实现精准推理。

2. **性能约束**：单用户并发请求响应时间≤30秒，支持10并发用户同时操作，日志解析支持单条日志最大100KB，批量上传支持单次≤100条日志。

3. **运维约束**：系统部署、启动、停止、备份均需支持一键操作，无复杂命令行交互；故障排查需提供明确的日志与监控指标，便于快速定位问题。

4. **安全约束**：支持用户身份认证（JWT），操作日志全程审计，禁止未授权访问系统核心能力与数据；芯片日志、故障数据、专家知识等核心数据需加密存储，防止泄露。

5. **兼容性约束**：支持Windows、Linux、MacOS三种操作系统的终端接入；支持Chrome、Edge、Firefox等主流浏览器（版本≥90）访问前端管理端。

## 1.4 适用范围

本方案适用于芯片失效分析AI Agent系统的研发、部署、测试、运维及后期扩展，覆盖系统全生命周期；适用于内部芯片研发团队、失效分析团队、量产测试团队，用于芯片故障日志分析、失效模块定位、故障根因推理、分析报告生成及知识沉淀；适用于主流SoC、MCU芯片的失效分析场景，可根据具体芯片型号扩展适配。

# 二、总体架构设计

## 2.1 架构概述

本系统采用“分层架构+组件化设计”模式，结合AI领域MCP（Model Context Protocol）标准与芯片领域业务特性，最终确定为5层架构，核心采用2-Agent折中方案，兼顾职责拆分与轻量化部署需求。架构自上而下分为：终端接入层、API网关层、AI Agent编排推理层、MCP标准能力层、知识图谱+数据存储层，各层职责边界清晰、松耦合，通过标准化接口实现交互，确保系统的可维护性、可扩展性与可落地性。

核心设计亮点：无独立芯片领域能力层，将芯片领域能力拆分为显性知识与隐性工程能力，分别融入知识图谱+数据存储层、MCP层，简化架构；以2个Agent为业务中枢，实现推理与落地的职责拆分；通过MCP层实现所有能力的标准化调用，实现Agent与底层工具/数据的完全解耦。

## 2.2 总体架构图

### Word适配版框图（可直接复制至Word，插入“框图-层次结构”后替换文本，无需手动绘制）：

1. 顶层：终端接入层

- 形式：React管理端 / Streamlit演示端 / 研发工具链插件

- 核心能力：日志上传、结果查看、专家修正、操作交互、权限管理

- 向下交互：通过HTTP/HTTPS请求对接API网关层

2. 第二层：API网关层

- 核心组件：Nginx + JWT + 限流/审计脚本

- 核心能力：路由分发、身份认证、限流、审计、非法请求过滤、请求转发

- 向下交互：将过滤、认证后的请求转发至AI Agent编排推理层

3. 第三层：AI Agent编排推理层（系统核心）

- 核心组件：LangGraph + 2-Agent + MCP客户端 + LLM

- 核心模块：Agent1（推理核心）、Agent2（落地闭环）

- 核心能力：流程编排、状态管理、多源推理、报告生成、结果落地、知识闭环

- 向下交互：通过MCP标准化调用请求对接MCP标准能力层

4. 第四层：MCP标准能力层（解耦核心）

- 核心组件：Anthropic MCP SDK + 工具插件

- 核心工具集：芯片专属插件、知识图谱工具、数据存储工具、通用工具

- 核心能力：能力封装、标准化调用、会话管理、异常统一处理、权限管控

- 向下交互：通过标准化指令对接知识图谱+数据存储层

5. 第五层：知识图谱+数据存储层（数据底座）

- 子层1：知识图谱子层

- 核心组件：Neo4j + YAML规则引擎

- 核心能力：显性知识存储、精准推理、知识关联查询

- 子层2：数据存储子层

- 核心组件：PostgreSQL + pgvector + Redis

- 核心能力：全量数据存储、向量匹配、热点数据缓存

6. 支撑层：基础设施层

- 核心组件：Docker Compose + 服务器

- 核心能力：容器化部署、监控运维、数据备份、算力支撑

### Word操作说明

复制上述框图内容，打开Word→插入→框图→选择“层次结构”（推荐“组织架构图”）→双击框图文本，粘贴对应层级内容，调整框图大小与间距，即可生成规范的Word版架构框图，与原文架构完全一致。

### 文字版架构图（备用，可直接复制查看层级）

┌─────────────────────────────────────────────────────────────────────┐

│ 【终端接入层】                                                      │

│ 形式：React管理端 / Streamlit演示端 / 研发工具链插件                │

│ 能力：日志上传、结果查看、专家修正、操作交互                        │

└────────────────────────────┬────────────────────────────────────────┘

│ （HTTP/HTTPS请求）

┌────────────────────────────▼────────────────────────────────────────┐

│ 【API网关层】                                                       │

│ 核心：Nginx + JWT + 限流/审计脚本                                   │

│ 能力：路由分发、身份认证、限流、审计、非法请求过滤                  │

└────────────────────────────┬────────────────────────────────────────┘

│ （过滤后请求）

┌────────────────────────────▼────────────────────────────────────────┐

│ 【AI Agent编排推理层】                                              │

│ 核心：LangGraph + 2-Agent + MCP客户端 + LLM                         │

│ Agent1：推理核心 → 信息提取、多源推理、报告生成                     │

│ Agent2：落地闭环 → 结果存储、知识同步、终端返回                     │

└────────────────────────────┬────────────────────────────────────────┘

│ （MCP标准化调用请求）

┌────────────────────────────▼────────────────────────────────────────┐

│ 【MCP标准能力层】                                                   │

│ 核心：Anthropic MCP SDK + 工具插件                                 │

│ 工具集：芯片专属插件、知识图谱工具、数据存储工具、通用工具          │

└────────────────────────────┬────────────────────────────────────────┘

│ （标准化指令）

┌────────────────────────────▼────────────────────────────────────────┐

│ 【知识图谱+数据存储层】                                             │

│ ┌─────────────────────────────────────────────────────────────────┐ │

│ │ 知识图谱子层：Neo4j + YAML规则引擎 → 显性知识存储+精准推理       │ │

│ └─────────────────────────────────────────────────────────────────┘ │

│ ┌─────────────────────────────────────────────────────────────────┐ │

│ │ 数据存储子层：PG + pgvector + Redis → 全量数据存储+缓存          │ │

│ └─────────────────────────────────────────────────────────────────┘ │

└─────────────────────────────────────────────────────────────────────┘

│

▼

【基础设施层】Docker Compose + 服务器 → 轻量化部署与运维

## 2.3 分层职责详解

### 2.3.1 终端接入层

作为系统与用户的交互入口，提供多端接入能力，适配不同用户的使用场景，核心职责如下：

1. 日志上传：支持单条/批量上传芯片故障日志（格式支持txt、log、csv，单条最大100KB，批量≤100条），支持日志拖拽上传、文件选择上传。

2. 结果展示：展示故障特征提取结果、失效模块定位结果、根因推理结果、相似案例、分析报告，支持报告下载（格式：docx、pdf）。

3. 专家修正：提供专家审核界面，支持专家对低置信度推理结果进行修正，输入修正意见、调整根因与解决方案，提交后触发知识闭环。

4. 操作交互：提供用户登录/注册、芯片型号选择、故障类型筛选、历史结果查询、知识图谱可视化查看等功能。

5. 权限管理：区分普通用户（仅查看/上传）、专家用户（审核/修正）、管理员用户（系统配置/运维）三类角色，实现精细化权限控制。

### 2.3.2 API网关层

作为系统的轻量管控屏障，是终端接入层与Agent层的唯一交互桥梁，核心职责如下：

1. 路由分发：接收终端请求，根据请求类型（日志上传、结果查询、专家修正等）分发至对应的Agent接口，实现请求的精准路由。

2. 身份认证：基于JWT（JSON Web Token）实现用户身份认证，用户登录后生成临时Token，所有请求携带Token，验证通过后方可放行，防止未授权访问。

3. 限流管控：基于Nginx限流模块，实现单用户/单IP并发限流（默认单用户10并发，单IP20并发），防止系统过载。

4. 操作审计：记录所有用户的操作日志（用户ID、操作时间、操作类型、请求参数、响应结果），用于后期审计与故障追溯，日志保留周期≥90天。

5. 非法请求过滤：过滤非法请求（如恶意请求、无效参数、跨域非法请求），拦截SQL注入、XSS等常见攻击，保障系统安全。

6. 请求转发：将过滤、认证后的请求转发至Agent层，接收Agent层的响应结果，返回至终端接入层，实现请求的双向转发。

### 2.3.3 AI Agent编排推理层

系统的业务核心与推理中枢，采用2-Agent折中方案，基于LangGraph实现编排，核心职责如下：

1. Agent1（推理核心）：负责日志信息提取、多源融合推理、分析报告生成，是系统推理能力的核心载体，具体职责见第3章详细设计。

2. Agent2（落地闭环）：负责推理结果存储、知识同步更新、终端结果返回，实现系统的知识闭环与结果落地，具体职责见第3章详细设计。

3. 流程编排：通过LangGraph实现2个Agent的自动化流转，支持正常流程（Agent1→Agent2）与专家介入流程（Agent1→专家介入→Agent2）的动态切换。

4. 状态管理：维护全局推理状态，存储所有中间结果（故障特征、推理结果、专家意见等），实现Agent间的数据共享与链路追溯。

5. LLM集成：集成轻量大模型，用于分析报告生成、推理结果自然语言解释、边缘故障特征补全，不参与核心推理决策。

### 2.3.4 MCP标准能力层

基于Anthropic MCP协议的标准化能力网关，是Agent层与底层工具/数据层的唯一连接桥梁，核心职责如下：

1. 能力封装：将芯片专属工具、知识图谱、数据存储、通用工具等所有底层能力，封装为标准化MCP工具，提供统一的调用接口。

2. 标准化调用：接收Agent层的MCP调用请求，解析请求参数，调用对应的底层工具，将结果标准化后返回给Agent层，实现Agent与底层能力的解耦。

3. 会话管理：维护MCP调用会话上下文，存储调用中间结果，支持会话复用与中断恢复，确保推理链路的连续性。

4. 异常统一处理：拦截底层工具调用过程中的异常（如工具调用失败、数据查询异常），进行标准化异常封装，返回给Agent层，便于Agent层统一处理。

5. 权限管控：对底层工具的调用进行权限校验，确保只有授权的Agent请求才能调用核心工具（如芯片专属解析工具、知识图谱更新工具）。

### 2.3.5 知识图谱+数据存储层

系统的知识与数据双底座，负责存储系统全量知识与业务数据，提供精准推理与数据支撑，分为知识图谱子层与数据存储子层，核心职责如下：

1. 知识图谱子层：存储芯片失效领域的结构化知识，提供知识关联查询与规则驱动推理能力，支撑Agent1的多源推理。

2. 数据存储子层：存储系统全量业务数据（原始日志、故障特征、推理结果、专家意见等），提供数据读写、缓存、向量匹配等能力，支撑系统全流程运行。

3. 知识同步：接收Agent2的知识更新请求，将专家修正意见、新增案例等同步至知识图谱与数据库，实现知识闭环。

4. 数据支撑：为Agent1提供历史案例匹配、故障特征比对等数据支撑，为Agent2提供结果存储与查询能力。

### 2.3.6 基础设施层（支撑层）

作为系统的部署与运维支撑，核心职责如下：

1. 容器化部署：通过Docker Compose实现所有组件的容器化部署，支持一键启动、停止、重启。

2. 监控运维：集成Prometheus+Grafana实现系统监控（CPU、内存、接口响应时间、工具调用成功率等），集成Filebeat+ELK实现日志收集与排查。

3. 数据备份：实现知识图谱、数据库的定时全量备份，备份周期为每天凌晨，备份文件保留≥7天，支持故障恢复。

4. 算力支撑：提供服务器算力，支撑Agent推理、LLM调用、向量计算等核心操作，无需高端GPU（轻量大模型可选用CPU推理）。

## 2.4 核心设计原则

1. **职责单一原则**：各层、各模块、各Agent的职责单一，避免职责重叠，便于开发、维护与迭代（如Agent1只做推理，Agent2只做落地）。

2. **解耦设计原则**：通过MCP层实现Agent与底层工具/数据的完全解耦，底层工具/数据库的迭代不影响Agent层；各层之间通过标准化接口交互，层内组件松耦合。

3. **轻量化原则**：避免复杂中间件与冗余组件，采用Docker Compose部署，无K8s、微服务框架，降低部署与运维成本，适配内部轻量使用需求。

4. **可解释性原则**：核心推理链路全程可追溯、可可视化，拒绝黑盒推理，每一步推理结果均有明确依据，满足芯片工程化要求。

5. **可扩展原则**：模块设计模块化、接口标准化，支持新增芯片型号、新增故障类型、新增底层工具，便于后期扩展。

6. **知识闭环原则**：实现“推理→专家修正→知识更新→推理优化”的闭环，持续提升系统推理准确性与知识覆盖度。

# 三、核心模块设计（2-Agent折中方案）

## 3.1 Agent层总体设计

Agent层采用2-Agent折中方案，基于LangGraph实现流程编排，核心定位为“业务中枢+推理核心”，兼顾职责拆分与轻量化需求。2个Agent相互配合，实现从原始日志到最终结果落地的全流程闭环，Agent间通过全局状态共享数据，无需直接交互，降低耦合度。

核心设计思路：合并原3-Agent中的“信息提取”与“融合推理”逻辑，形成Agent1（推理核心），保留“结果落地+知识闭环”逻辑作为Agent2（落地闭环），既减少LangGraph编排节点，降低复杂度，又保留推理与落地的核心职责拆分，便于维护与迭代。

Agent层技术参数：

- 编排引擎：LangGraph 0.1.10（稳定版）

- 开发语言：Python 3.10（兼容3.9-3.11）

- MCP客户端：Anthropic MCP SDK 0.5.0

- LLM集成方式：SDK调用（支持OpenAI、开源LLaMA3、Qwen等）

- 状态存储：内存存储（默认）+ Redis缓存（可选，用于分布式部署）

- 响应时间：单条日志推理≤30秒，批量100条日志≤10分钟

## 3.2 Agent1：推理核心模块详细设计

### 3.2.1 模块定位

Agent1是系统的推理核心，负责从原始日志中提取故障特征，调用MCP层多源能力进行融合推理，判断是否需要专家介入，最终生成标准化分析报告，为Agent2提供推理结果支撑。

### 3.2.2 核心职责

1. 日志信息提取与标准化：接收经过网关过滤的原始日志与芯片型号，调用MCP芯片日志解析工具，提取故障特征（错误码、失效模块初步判断、故障参数等），并进行标准化处理（统一格式、清洗无效数据）。

2. 多源融合推理：调用MCP层的芯片工具、知识图谱、数据库工具，获取多源推理结果（失效模块定界结果、根因推理结果、历史案例匹配结果），通过自定义融合规则，输出最终失效模块、故障根因及置信度。

3. 专家介入判断：根据推理结果的置信度（阈值可配置，默认0.7），判断是否需要专家介入；若置信度<0.7，标记“需专家介入”，触发专家审核流程；若置信度≥0.7，直接将推理结果传递给Agent2。

4. 分析报告生成：调用轻量大模型，基于故障特征、推理结果、推理链路，生成符合芯片研发人员阅读习惯的标准化分析报告，包含日志信息、特征提取结果、失效模块、根因、推理依据、解决方案建议等内容。

5. 推理链路记录：记录整个推理过程的所有中间结果（特征提取结果、多源调用结果、融合逻辑、置信度计算过程），用于推理链路追溯与可解释性展示。

### 3.2.3 核心流程

1. 接收请求：从API网关层接收经过过滤、认证的请求，包含芯片型号、原始日志、会话ID、用户ID等信息。

2. 特征提取：调用MCP“芯片日志解析工具”，传入芯片型号与原始日志，提取故障特征，进行标准化处理，存储至全局状态。

3. 多源调用：
        

    - 调用MCP“芯片失效定界工具”：传入芯片型号与标准化故障特征，获取失效模块定界结果（模块名称、置信度、定界依据）。

    - 调用MCP“知识图谱推理工具”：传入芯片型号与故障特征，获取根因推理结果（根因名称、置信度、关联知识链路）。

    - 调用MCP“历史案例匹配工具”：传入故障特征向量，从pgvector中匹配相似历史案例，获取案例匹配结果（案例ID、相似度、根因、解决方案）。

4. 融合推理：
        

    - 置信度计算：对多源推理结果进行置信度加权计算（芯片工具权重0.4，知识图谱权重0.3，案例匹配权重0.3）。

    - 结果融合：取加权置信度最高的失效模块与根因，作为最终推理结果；若多源结果冲突（置信度差值<0.1），标记为“结果冲突”，触发专家介入。

    - 结果校验：校验推理结果的合理性（如失效模块与芯片型号是否匹配、根因与故障特征是否关联），若不合理，触发专家介入。

5. 专家介入判断：判断最终推理结果的置信度，若≥0.7，进入报告生成环节；若<0.7，标记“需专家介入”，暂停流程，等待专家修正。

6. 报告生成：调用LLM，传入故障特征、推理结果、推理链路，生成标准化分析报告，存储至全局状态。

7. 流程流转：将推理结果、分析报告、专家介入标识传递给Agent2（或触发专家介入节点）。

### 3.2.4 核心算法与规则

#### 3.2.4.1 故障特征标准化算法

采用“字段映射+清洗+归一化”三步算法，将不同芯片型号的日志特征统一为标准化格式：

1. 字段映射：基于知识图谱中的“芯片型号-日志字段映射表”，将不同芯片的日志字段（如错误码、寄存器地址、电压值）映射为统一字段（error_code、register_addr、voltage）。

2. 数据清洗：过滤无效数据（如空值、异常值、重复数据），修正格式错误（如电压值单位统一为V，时间格式统一为YYYY-MM-DD HH:MM:SS）。

3. 归一化：将数值型特征（如电压、温度）归一化至[0,1]区间，便于后续置信度计算与向量匹配；将分类型特征（如错误码）转换为编码格式，便于计算机处理。

#### 3.2.4.2 多源结果融合规则

融合规则可配置（存储在PostgreSQL规则表中，专家可编辑），默认规则如下：

1. 置信度加权公式：最终置信度 = 芯片工具结果置信度×0.4 + 知识图谱结果置信度×0.3 + 案例匹配相似度×0.3。

2. 结果冲突处理：若多源结果的置信度差值<0.1，标记为“结果冲突”，触发专家介入；若差值≥0.1，取置信度最高的结果作为最终结果。

3. 合理性校验规则：
        

    - 失效模块校验：校验失效模块是否属于当前芯片型号的核心模块（基于知识图谱中的“芯片-模块”关联关系），若不属于，标记为不合理。

    - 根因校验：校验根因与故障特征是否存在关联关系（基于知识图谱中的“故障特征-根因”关联关系），若无关联，标记为不合理。

#### 3.2.4.3 专家介入阈值配置

专家介入阈值可通过前端管理员界面配置，支持按芯片型号、故障类型分别配置阈值，默认全局阈值为0.7：

- 高风险芯片型号（如量产芯片）：阈值可提高至0.8，确保推理准确性。

- 低风险芯片型号（如研发测试芯片）：阈值可降低至0.6，提升自动化率。

- 新型故障类型：阈值可提高至0.85，减少误判。

### 3.2.5 输入输出定义

#### 3.2.5.1 输入参数

|参数名称|参数类型|是否必填|描述|示例|
|---|---|---|---|---|
|session_id|string|是|会话ID，用于唯一标识一次推理流程|session_20240520_123456|
|user_id|string|是|用户ID，用于操作审计与权限校验|user_001|
|chip_model|string|是|芯片型号，用于适配不同芯片的解析规则与知识|XX-SoC01|
|raw_log|string|是|芯片原始故障日志，支持多行文本|XX-SoC01 0x0012 寄存器读写出错 电压不稳定 温度45℃|
|infer_threshold|float|否|专家介入阈值，覆盖全局默认阈值|0.7|
#### 3.2.5.2 输出参数（存储至全局状态）

|参数名称|参数类型|描述|示例|
|---|---|---|---|
|fault_features|dict|标准化故障特征集|{"error_code":"0x0012","register_addr":"0x10","voltage":3.3,"temperature":45,"fault_desc":"寄存器读写出错"}|
|delimit_results|list[dict]|多源失效模块定界结果|[{"type":"chip_tool","module":"SRAM","confidence":0.85},{"type":"kg","module":"SRAM","confidence":0.8},{"type":"case","module":"SRAM","similarity":0.9}]|
|final_root_cause|dict|最终推理结果（失效模块+根因+置信度）|{"module":"SRAM","root_cause":"供电电压波动","confidence":0.845,"reason":"多源结果融合，芯片工具定界置信度0.85，知识图谱推理置信度0.8，案例匹配相似度0.9，加权计算得最终置信度0.845"}|
|need_expert|bool|是否需要专家介入|false|
|infer_report|string|标准化分析报告|芯片型号：XX-SoC01...（完整报告内容）|
|infer_trace|list[dict]|推理链路记录|[{"step":"特征提取","result":"...","time":"2024-05-20 12:35:00"},{"step":"多源调用","result":"...","time":"2024-05-20 12:35:05"}]|
## 3.3 Agent2：落地闭环模块详细设计

### 3.3.1 模块定位

Agent2是系统的落地与闭环核心，负责接收Agent1的推理结果（或专家修正后的结果），将结果落地存储至数据库，同步更新知识图谱，返回结果至终端接入层，完成整个流程的闭环，同时实现知识的迭代更新。

### 3.3.2 核心职责

1. 推理结果落地存储：将Agent1的推理结果（故障特征、最终根因、分析报告、推理链路）、专家修正意见（若有），统一存储至PostgreSQL数据库，将故障特征向量存储至pgvector，用于后续案例匹配。

2. 知识同步更新：若有专家修正意见，调用MCP知识图谱工具与数据库工具，将修正后的根因、解决方案、故障特征等信息同步至知识图谱（更新实体、关系、规则）与数据库（更新案例库、规则表），实现知识闭环。

3. 终端结果返回：将推理结果、分析报告、落地状态、知识同步状态，通过MCP通用工具与API网关，返回至终端接入层，供用户查看与下载。

4. 热点数据缓存：将高频访问的推理结果、热点故障案例、常用知识，缓存至Redis，提升终端查询效率。

5. 闭环日志记录：记录结果落地、知识同步、终端返回的全过程，用于审计与故障追溯，日志与Agent1的推理链路日志关联，形成完整的流程日志。

### 3.3.3 核心流程

1. 接收数据：从Agent1（或专家介入节点）接收推理结果、分析报告、专家介入标识、专家修正意见（若有）等数据，从全局状态中读取相关信息。

2. 结果落地存储：
        

    - 调用MCP“PostgreSQL存储工具”：将session_id、user_id、chip_model、故障特征、最终根因、分析报告、推理链路、专家意见等信息，写入对应的数据库表。

    - 调用MCP“pgvector存储工具”：将标准化故障特征向量，写入向量表，关联session_id与芯片型号，用于后续相似案例匹配。

3. 知识同步更新（有专家修正意见时）：
        

    - 调用MCP“知识图谱更新工具”：根据专家修正意见，更新知识图谱中的实体（如新增根因、修改模块-根因关联关系）、关系、推理规则。

    - 调用MCP“数据库更新工具”：将修正后的案例，写入历史案例库；将修正后的规则，写入规则表；更新推理结果表中的根因与置信度。

4. 热点数据缓存：调用MCP“Redis缓存
> （注：文档部分内容可能由 AI 生成）